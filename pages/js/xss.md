# 跨站脚本攻击（Cross Site Scripting）

> 跨站脚本攻击（Cross Site Scripting）是最常见和基本的攻击 WEB 网站方法，攻击者通过注入非法的 html 标签或者 javascript 代码，从而当用户浏览该网页时，控制用户浏览器。

## xss 主要分为三类

1. DOM xss :
   DOM 即文本对象模型，DOM 通常代表在 html、xhtml 和 xml 中的对象，使用 DOM 可以允许程序和脚本动态的访问和更新文档的内容、结构和样式。它不需要服务器解析响应的直接参与，触发 XSS 靠的是浏览器端的 DOM 解析，可以认为完全是客户端的事情。

    - 攻击步骤：
        - 攻击者构造出特殊的 URL，其中包含恶意代码。
        - 用户被诱导打开带有恶意代码的 URL。
        - 用户浏览器接收到响应后解析执行，前端 JavaScript 取出 URL 中的恶意代码并执行。
        - 恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。

2. 反射型 xss :
   攻击者诱导用户访问一个带有恶意代码的 URL 后，服务器端接收数据后处理，然后把带有恶意代码的数据发送到浏览器端，浏览器端解析这段带有 XSS 代码的数据后当做脚本执行，最终完成 XSS 攻击。因为这个过程就像一次反射，故称为反射型 XSS。

    - 攻击步骤：
        - 攻击者创造一个携带恶意代码的 url。
        - 用户被诱导打开带有恶意代码的 URL，服务器端将恶意代码从 URL 中取出当做参数处理，然后返回给用户带有恶意代码的数据。
        - 用户浏览器接收到响应解析执行，混在其中的恶意代码也被执行。
        - 恶意代码窃取用户敏感数据发送给攻击者，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。

3. 存储型 xss :
   存储型 XSS 又被称为持久性 XSS，它是最危险的一种跨站脚本，相比反射型 XSS 和 DOM 型 XSS 具有更高的隐蔽性，所以危害更大，因为它不需要用户手动触发。 允许用户存储数据的 web 程序都可能存在存储型 XSS 漏洞，当攻击者提交一段 XSS 代码后，被服务器端接收并存储，当所有浏览者访问某个页面时都会被 XSS，其中最典型的例子就是留言板。

    - 攻击步骤：
        - 攻击者把恶意代码提交到目标网站的服务器中。
        - 用户打开目标网站，网站服务器端把带有恶意代码的数据取出，当做正常数据返回给用户。
        - 用户浏览器接收到响应解析执行，混在其中的恶意代码也被执行。
        - 恶意代码窃取用户敏感数据发送给攻击者，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。

## 攻击手段和目的

    1. 盗用 cookie，获取敏感信息。
    2. 利用植入 Flash，通过 crossdomain 权限设置进一步获取更高权限；或者利用 Java 等得到类似的操作。
    3. 利用 iframe、frame、XMLHttpRequest 或上述 Flash 等方式，以（被攻击）用户的身份执行一些管理动作，或
    4. 执行一些一般的如发微博、加好友、发私信等操作。
    5. 利用可被攻击的域受到其他域信任的特点，以受信任来源的身份请求一些平时不允许的操作，如进行不当的投票活动。
    6. 在访问量极大的一些页面上的 XSS 可以攻击一些小型网站，实现 DoS 攻击的效果。

## 如何防御

1. HttpOnly ：如果某个 Cookie 带有该属性，则该条 Cookie 禁止脚本读取
2. 输入检查 ： 不要相信任何输入的内容，限制输入允许的字符，让一下特殊字符的攻击失效
3. 输出检查 ：
